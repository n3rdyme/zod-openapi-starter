Here's the updated README with links to documentation for each dependency, including the addition of `ts-proto`:

---

# `proto` Directory

The `proto` directory contains the necessary scripts and configurations to generate and manage gRPC and Protocol Buffers definitions from the OpenAPI specification of the project. This setup uses various tools to convert OpenAPI specifications into `.proto` files, allowing seamless integration with gRPC services.

## Folder Contents

### Main Script

- **`build.sh`**: Main build script to convert the OpenAPI specification to `.proto` files and TypeScript definitions.
  - Reads `openapi.json` from `packages/api/dist` to set the gRPC service and package names.
  - Downloads Google API Protobuf definitions (`annotations.proto` and `http.proto`), required for handling HTTP and gRPC transcoding.
  - Prepares and repairs the `.proto` file for gRPC compatibility using `gnosticPrepare.mjs` and `gnosticRepair.mjs`.
  - Generates TypeScript definitions in the `client-grpc` and `service` packages.

#### Usage

1. **Build Protobuf Files**:
   ```bash
   ./build.sh
   ```
   This will generate `.proto` files and TypeScript definitions, this utility script is called by the `build` task of the `packages/api` project. You should not need to call it directly.

### Supporting Scripts

- **`install.sh`**: Installs necessary tools and dependencies (called by ./build.sh).

  - **Protobuf Compiler (`protoc`)**: Downloads and installs `protoc` locally if not already available.
  - **Gnostic and Gnostic-GRPC**: Installs `gnostic` and `gnostic-grpc`, which convert OpenAPI specifications to Protocol Buffers files.
  - Ensures essential utilities like `curl`, `unzip`, and `go` are available.

- **`gnosticPrepare.mjs`**: Prepares the OpenAPI specification for `gnostic` by:

  - Combining path, query, and body parameters into a single request schema for each operation.
  - Cleaning up unused schemas to streamline the output.
  - Adding custom extensions like `x-original-path` for tracking the initial path.

- **`gnosticRepair.mjs`**: Fixes issues in the `.proto` files generated by `gnostic-grpc`, such as:
  - Removing unused types generated by `gnostic-grpc`.
  - Adding `optional` keywords for fields that are not required in the OpenAPI specification.
  - Replacing placeholders with actual service and package names defined in the OpenAPI spec.

### `protoc` Binary

The `protoc` binary is a locally installed Protocol Buffers compiler, used to validate and compile `.proto` files. It’s installed by `install.sh` and allows building gRPC services without requiring a globally installed version of `protoc`.

## Workflow Overview

1. **Setup**: Run `install.sh` to install dependencies and tools.
2. **Build**: Run `build.sh` to convert `openapi.json` into `.proto` files and generate TypeScript types.
3. **Custom Processing**: The `gnosticPrepare.mjs` and `gnosticRepair.mjs` scripts modify the `.proto` files to ensure compatibility with gRPC standards and the project’s requirements.

## Dependencies

- **[Protobuf Compiler (`protoc`)](https://grpc.io/docs/protoc-installation/)**: For compiling `.proto` files into gRPC services.
- **[Gnostic](https://github.com/google/gnostic)** & **[Gnostic-GRPC](https://github.com/google/gnostic-grpc)**: Tools to transform OpenAPI specs into Protocol Buffers definitions.
- **[Node.js](https://nodejs.org/)**: Required for running the preparation and repair scripts (`gnosticPrepare.mjs` and `gnosticRepair.mjs`).
- **[Go](https://golang.org/doc/install)**: Required for installing `gnostic` and `gnostic-grpc` tools.
- **[ts-proto](https://github.com/stephenh/ts-proto)**: A TypeScript code generator for Protocol Buffers, used to generate TypeScript types from `.proto` files. This package allows seamless integration of gRPC types into TypeScript projects.

## Technologies Used

- **[Protocol Buffers (Protobuf)](https://developers.google.com/protocol-buffers)**: For serializing structured data, essential for gRPC communication.
- **[gRPC](https://grpc.io/)**: Enables efficient, type-safe remote procedure calls (RPCs) between services.
- **[OpenAPI](https://swagger.io/specification/)**: Defines the RESTful API structure, which is then converted to gRPC-compatible `.proto` files.
- **[Gnostic](https://github.com/google/gnostic)**: A tool for transforming OpenAPI specifications into other formats, such as Protocol Buffers.
